{"remainingRequest":"C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\src\\components\\File.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\src\\components\\File.vue","mtime":1704873277355},{"path":"C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\babel.config.js","mtime":1658915792000},{"path":"C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1704530833875},{"path":"C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1704530835864},{"path":"C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1704530833875},{"path":"C:\\Users\\Administrator\\Documents\\WeChat Files\\wxid_2tq3pa46vu5j51\\FileStorage\\File\\2024-01\\wms-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1704530838239}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKZXhwb3J0IGZ1bmN0aW9uIHVwbG9hZFJlc3VsdCgpIHsKICAvLyDkuIrkvKDmlofku7bnmoTmlrnms5UKICByZXR1cm4gYXhpb3MuY3JlYXRlKHsKICAgIHdpdGhDcmVkZW50aWFsczogdHJ1ZQogIH0pOwp9CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiRmlsZSIsCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgdGFnczogWyLmuLjmiI8iLCAi5a2m5LmgIiwgIuWtpuacryIsICLlqLHkuZAiLCAi5bel5L2cIl0sCiAgICAgIC8vIOWPr+mAieaLqeeahOagh+etvgogICAgICBzZWxlY3RlZFRhZ3M6IFtdLAogICAgICB1c2VyOiBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ0N1clVzZXInKSksCiAgICAgIGZpbGVMaXN0OiBbXQogICAgfTsKICB9LAoKICBjb21wdXRlZDoge30sCiAgbWV0aG9kczogewogICAgc2hvd0RpYWxvZygpIHsKICAgICAgLy8g5qOA6aqM55So5oi35piv5ZCm5pyq6YCJ5Y+W5paH5Lu25bCx5LiK5LygCiAgICAgIGlmICh0aGlzLmZpbGVMaXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygn6K+35re75Yqg5paH5Lu2Jyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGVkVGFncyA9IFtdOwogICAgICB0aGlzLmRpYWxvZ1Zpc2libGUgPSB0cnVlOwogICAgfSwKCiAgICBjb25maXJtU2VsZWN0aW9uKCkgewogICAgICBjb25zb2xlLmxvZygi5bey6YCJ5oup55qE5qCH562+OiIsIHRoaXMuc2VsZWN0ZWRUYWdzKTsKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CiAgICAgIHRoaXMuc3VibWl0VXBsb2FkKCk7CiAgICB9LAoKICAgIGZpbGVDaGFuZ2UoZmlsZSwgZmlsZUxpc3QpIHsKICAgICAgLy8g5Zug5Li65piv6ZmQ5Yi25Li65Y+q6IO95LiK5Lyg5LiA5Liq5paH5Lu277yM5omA5Lul5YmN56uv6YCJ5Y+W5paH5Lu25pe277yM5aaC5p6c6YCJ5Y+W56ys5LqM5Liq5paH5Lu25pe277yM6KaB5oqK56ys5LiA5Liq5paH5Lu257uZ6KaG55uW5o6J44CCCiAgICAgIHRoaXMuZmlsZUxpc3QgPSBbZmlsZUxpc3RbZmlsZUxpc3QubGVuZ3RoIC0gMV1dOyAvLyDkuZ/lj6/ku6Xov5nmoLflhpnvvJoKICAgICAgLy8gdGhpcy5maWxlTGlzdCA9IFtmaWxlXTsKICAgIH0sCgogICAgcmVzZXQoKSB7CiAgICAgIC8vIOW9k+WvueivneahhuWFs+mXreaXtu+8jOa4heepuuW3suS4iuS8oOeahOaWh+S7tuWIl+ihqO+8jOWQjOaXtmZpbGVMaXN06YeN5paw6K6+572u5Li656m65pWw57uECiAgICAgIHRoaXMuJHJlZnMudXBsb2FkLmNsZWFyRmlsZXMoKTsgLy8g6L+Z5Liq5pivZWwtdXBsb2Fk6Ieq5bim55qE5riF56m65paH5Lu25YiX6KGo5pa55rOVCgogICAgICB0aGlzLmZpbGVMaXN0ID0gW107CiAgICB9LAoKICAgIHVwbG9hZEh0dHBSZXF1ZXN0KCkgewogICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCB0aGlzLmZpbGVMaXN0WzBdLnJhdyk7IC8vIOimgeS4iuS8oOeahOaWh+S7tgoKICAgICAgZm9ybURhdGEuYXBwZW5kKCd1c2VySWQnLCB0aGlzLnVzZXIuaWQpOyAvLyDnlKjmiLdpZAoKICAgICAgY29uc3QgbGFiZWwgPSB0aGlzLnNlbGVjdGVkVGFncy5qb2luKCcsJyk7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbGFiZWwnLCBsYWJlbCk7IC8vICR7c2VydmVyLnVybH0vY29tcC91cGxvYWRSZXN1bHQg6L+Z5Liq5piv5ZCO56uv5o6l5pS255qE5o6l5Y+jCiAgICAgIC8vIHdpdGhDcmVkZW50aWFsczogdHJ1ZeS4gOWumuimgeiuvue9ru+8jOWQpuWImeWPr+iDveS8muS4iuS8oOS4jeaIkOWKn++8jOi/meaYr+S4quWdkQoKICAgICAgY29uc29sZS5sb2coIuWHhuWkh+S4iuS8oCIpOwogICAgICB1cGxvYWRSZXN1bHQoKS5wb3N0KHRoaXMuJGh0dHBVcmwgKyAnL2NvbXAvdXBsb2FkUmVzdWx0JywgZm9ybURhdGEpLnRoZW4ocmVzID0+IHJlcy5kYXRhKS50aGVuKHJlcyA9PiB7CiAgICAgICAgY29uc29sZS5sb2cocmVzKTsKCiAgICAgICAgaWYgKHJlcy5jb2RlID09PSAxKSB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+S4iuS8oOaIkOWKnycpOwogICAgICAgICAgdGhpcy5maWxlTGlzdCA9IFtdOyAvLyDkuIrkvKDmiJDlip/lsLHliJ3lp4vljJbmlofku7bliJfooagKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigpOyAvLyDkuIrkvKDlpLHotKXlsLHovpPlh7rlpLHotKXkv6Hmga8KICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihlcnIpOwogICAgICB9KTsKICAgIH0sCgogICAgLy8g6Ieq5a6a5LmJ5LiK5Lyg5Yqf6IO9CiAgICBzdWJtaXRVcGxvYWQoKSB7CiAgICAgIHRoaXMuJHJlZnMudXBsb2FkLnN1Ym1pdCgpOyAvLyDov5nkuKrkvJrop6blj5F1cGxvYWTnmoRodHRwLXJlcXVlc3TvvIzmiYvliqjkuIrkvKDmlofku7YKICAgIH0KCiAgfQp9Ow=="},{"version":3,"mappings":"AACA;AAIA;EAAA;EACA;IACAA;EADA;AAGA;AAEA;EACAC,YADA;;EAEAC;IAEA;MACAC,oBADA;MAEAC,oCAFA;MAEA;MACAC,gBAHA;MAIAC,mDAJA;MAKAC;IALA;EAOA,CAXA;;EAYAC,YAZA;EAeAC;IACAC;MACA;MACA;QACA;QACA;MACA;;MACA;MACA;IACA,CATA;;IAUAC;MACAC;MACA;MACA;IACA,CAdA;;IAeAC;MACA;MACA,gDAFA,CAGA;MACA;IACA,CApBA;;IAqBAC;MACA;MACA,+BAFA,CAEA;;MACA;IACA,CAzBA;;IA0BAC;MACA;MACAC,8CAFA,CAEA;;MACAA,wCAHA,CAGA;;MACA;MACAA,gCALA,CAMA;MACA;;MACAJ;MACAK;QACAL;;QACA;UACA;UACA,mBAFA,CAEA;QACA,CAHA,MAGA;UACA,sBADA,CACA;QACA;MACA,CARA,EAQAM,KARA,CAQAC;QACA;MACA,CAVA;IAWA,CA9CA;;IA+CA;IACAC;MACA,2BADA,CACA;IACA;;EAlDA;AAfA","names":["withCredentials","name","data","dialogVisible","tags","selectedTags","user","fileList","computed","methods","showDialog","confirmSelection","console","fileChange","reset","uploadHttpRequest","formData","uploadResult","catch","err","submitUpload"],"sourceRoot":"src/components","sources":["File.vue"],"sourcesContent":["<script>\r\nimport axios from 'axios'\r\n\r\n\r\n\r\nexport function uploadResult(){ // 上传文件的方法\r\n    return axios.create({\r\n        withCredentials: true,\r\n    });\r\n}\r\n\r\nexport default {\r\n    name: \"File\",\r\n    data() {\r\n\r\n        return {\r\n          dialogVisible: false,\r\n          tags: [\"游戏\", \"学习\", \"学术\", \"娱乐\", \"工作\"], // 可选择的标签\r\n          selectedTags: [],\r\n            user : JSON.parse(sessionStorage.getItem('CurUser')),\r\n            fileList: [],\r\n        }\r\n    },\r\n    computed:{\r\n\r\n    },\r\n    methods:{\r\n      showDialog() {\r\n        // 检验用户是否未选取文件就上传\r\n        if(this.fileList.length === 0){\r\n          this.$message.warning('请添加文件');\r\n          return\r\n        }\r\n        this.selectedTags = []\r\n        this.dialogVisible = true;\r\n      },\r\n      confirmSelection() {\r\n        console.log(\"已选择的标签:\", this.selectedTags);\r\n        this.dialogVisible = false;\r\n        this.submitUpload()\r\n      },\r\n        fileChange(file, fileList) {\r\n            // 因为是限制为只能上传一个文件，所以前端选取文件时，如果选取第二个文件时，要把第一个文件给覆盖掉。\r\n            this.fileList = [fileList[fileList.length - 1]];\r\n            // 也可以这样写：\r\n            // this.fileList = [file];\r\n        },\r\n        reset(){\r\n            // 当对话框关闭时，清空已上传的文件列表，同时fileList重新设置为空数组\r\n            this.$refs.upload.clearFiles(); // 这个是el-upload自带的清空文件列表方法\r\n            this.fileList = [];\r\n        },\r\n        uploadHttpRequest(){\r\n            const formData = new FormData();\r\n            formData.append('file', this.fileList[0].raw); // 要上传的文件\r\n            formData.append('userId', this.user.id); // 用户id\r\n            const label = this.selectedTags.join(',');\r\n          formData.append('label', label);\r\n          // ${server.url}/comp/uploadResult 这个是后端接收的接口\r\n            // withCredentials: true一定要设置，否则可能会上传不成功，这是个坑\r\n            console.log(\"准备上传\")\r\n            uploadResult().post(this.$httpUrl+'/comp/uploadResult', formData).then(res => res.data) .then(res =>{\r\n                console.log(res)\r\n                if(res.code === 1){\r\n                    this.$message.success('上传成功');\r\n                    this.fileList = []; // 上传成功就初始化文件列表\r\n                }else{\r\n                    this.$message.error(); // 上传失败就输出失败信息\r\n                }\r\n            }).catch(err =>{\r\n                this.$message.error(err);\r\n            });\r\n        },\r\n        // 自定义上传功能\r\n        submitUpload(){\r\n            this.$refs.upload.submit(); // 这个会触发upload的http-request，手动上传文件\r\n        },\r\n\r\n\r\n\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n<!--        <el-dialog width=\"400px\" top=\"8vh\" title=\"上传文件\" @close=\"closeUpload\" :visible.sync=\"upload_visible\">-->\r\n            <el-upload :file-list=\"fileList\"\r\n                       :auto-upload=\"false\"\r\n                       :http-request=\"uploadHttpRequest\"\r\n                       class=\"upload-demo\"\r\n                       :on-change=\"fileChange\"\r\n                       ref=\"upload\"\r\n                       drag\r\n                       action=\"#\">\r\n                <i class=\"el-icon-upload\"/>\r\n                <div class=\"el-upload__text\">将文件拖到此处，或<em>点击选取文件</em></div>\r\n                <div slot=\"tip\" class=\"el-upload__tip\">一次只能上传一个文件</div>\r\n            </el-upload>\r\n            <el-button type=\"danger\" @click=\"reset\" style=\"margin-left: 30px; margin-top: 20px\">清空列表</el-button>\r\n            <el-button type=\"success\" @click=\"showDialog\" style=\"margin-left: 30px; margin-top: 20px\">上传</el-button>\r\n<!--        </el-dialog>-->\r\n\r\n      <el-dialog :visible.sync=\"dialogVisible\" title=\"请选择文件标签\">\r\n        <el-checkbox-group v-model=\"selectedTags\">\r\n          <el-checkbox v-for=\"tag in tags\" :label=\"tag\" :key=\"tag\">{{ tag }}</el-checkbox>\r\n        </el-checkbox-group>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmSelection\">确定</el-button>\r\n      </span>\r\n      </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"]}]}