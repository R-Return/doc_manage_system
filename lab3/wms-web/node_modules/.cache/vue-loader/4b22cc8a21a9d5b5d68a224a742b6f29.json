{"remainingRequest":"C:\\Users\\admin\\Desktop\\wms-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\admin\\Desktop\\wms-web\\src\\components\\File.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\admin\\Desktop\\wms-web\\src\\components\\File.vue","mtime":1704873277355},{"path":"C:\\Users\\admin\\Desktop\\wms-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1704530833875},{"path":"C:\\Users\\admin\\Desktop\\wms-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1704530835864},{"path":"C:\\Users\\admin\\Desktop\\wms-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1704530833875},{"path":"C:\\Users\\admin\\Desktop\\wms-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1704530838239}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnDQoNCg0KDQpleHBvcnQgZnVuY3Rpb24gdXBsb2FkUmVzdWx0KCl7IC8vIOS4iuS8oOaWh+S7tueahOaWueazlQ0KICAgIHJldHVybiBheGlvcy5jcmVhdGUoew0KICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRydWUsDQogICAgfSk7DQp9DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgICBuYW1lOiAiRmlsZSIsDQogICAgZGF0YSgpIHsNCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLA0KICAgICAgICAgIHRhZ3M6IFsi5ri45oiPIiwgIuWtpuS5oCIsICLlrabmnK8iLCAi5aix5LmQIiwgIuW3peS9nCJdLCAvLyDlj6/pgInmi6nnmoTmoIfnrb4NCiAgICAgICAgICBzZWxlY3RlZFRhZ3M6IFtdLA0KICAgICAgICAgICAgdXNlciA6IEpTT04ucGFyc2Uoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnQ3VyVXNlcicpKSwNCiAgICAgICAgICAgIGZpbGVMaXN0OiBbXSwNCiAgICAgICAgfQ0KICAgIH0sDQogICAgY29tcHV0ZWQ6ew0KDQogICAgfSwNCiAgICBtZXRob2RzOnsNCiAgICAgIHNob3dEaWFsb2coKSB7DQogICAgICAgIC8vIOajgOmqjOeUqOaIt+aYr+WQpuacqumAieWPluaWh+S7tuWwseS4iuS8oA0KICAgICAgICBpZih0aGlzLmZpbGVMaXN0Lmxlbmd0aCA9PT0gMCl7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCfor7fmt7vliqDmlofku7YnKTsNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICB0aGlzLnNlbGVjdGVkVGFncyA9IFtdDQogICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7DQogICAgICB9LA0KICAgICAgY29uZmlybVNlbGVjdGlvbigpIHsNCiAgICAgICAgY29uc29sZS5sb2coIuW3sumAieaLqeeahOagh+etvjoiLCB0aGlzLnNlbGVjdGVkVGFncyk7DQogICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlOw0KICAgICAgICB0aGlzLnN1Ym1pdFVwbG9hZCgpDQogICAgICB9LA0KICAgICAgICBmaWxlQ2hhbmdlKGZpbGUsIGZpbGVMaXN0KSB7DQogICAgICAgICAgICAvLyDlm6DkuLrmmK/pmZDliLbkuLrlj6rog73kuIrkvKDkuIDkuKrmlofku7bvvIzmiYDku6XliY3nq6/pgInlj5bmlofku7bml7bvvIzlpoLmnpzpgInlj5bnrKzkuozkuKrmlofku7bml7bvvIzopoHmiornrKzkuIDkuKrmlofku7bnu5nopobnm5bmjonjgIINCiAgICAgICAgICAgIHRoaXMuZmlsZUxpc3QgPSBbZmlsZUxpc3RbZmlsZUxpc3QubGVuZ3RoIC0gMV1dOw0KICAgICAgICAgICAgLy8g5Lmf5Y+v5Lul6L+Z5qC35YaZ77yaDQogICAgICAgICAgICAvLyB0aGlzLmZpbGVMaXN0ID0gW2ZpbGVdOw0KICAgICAgICB9LA0KICAgICAgICByZXNldCgpew0KICAgICAgICAgICAgLy8g5b2T5a+56K+d5qGG5YWz6Zet5pe277yM5riF56m65bey5LiK5Lyg55qE5paH5Lu25YiX6KGo77yM5ZCM5pe2ZmlsZUxpc3Tph43mlrDorr7nva7kuLrnqbrmlbDnu4QNCiAgICAgICAgICAgIHRoaXMuJHJlZnMudXBsb2FkLmNsZWFyRmlsZXMoKTsgLy8g6L+Z5Liq5pivZWwtdXBsb2Fk6Ieq5bim55qE5riF56m65paH5Lu25YiX6KGo5pa55rOVDQogICAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gW107DQogICAgICAgIH0sDQogICAgICAgIHVwbG9hZEh0dHBSZXF1ZXN0KCl7DQogICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOw0KICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgdGhpcy5maWxlTGlzdFswXS5yYXcpOyAvLyDopoHkuIrkvKDnmoTmlofku7YNCiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgndXNlcklkJywgdGhpcy51c2VyLmlkKTsgLy8g55So5oi3aWQNCiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gdGhpcy5zZWxlY3RlZFRhZ3Muam9pbignLCcpOw0KICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbGFiZWwnLCBsYWJlbCk7DQogICAgICAgICAgLy8gJHtzZXJ2ZXIudXJsfS9jb21wL3VwbG9hZFJlc3VsdCDov5nkuKrmmK/lkI7nq6/mjqXmlLbnmoTmjqXlj6MNCiAgICAgICAgICAgIC8vIHdpdGhDcmVkZW50aWFsczogdHJ1ZeS4gOWumuimgeiuvue9ru+8jOWQpuWImeWPr+iDveS8muS4iuS8oOS4jeaIkOWKn++8jOi/meaYr+S4quWdkQ0KICAgICAgICAgICAgY29uc29sZS5sb2coIuWHhuWkh+S4iuS8oCIpDQogICAgICAgICAgICB1cGxvYWRSZXN1bHQoKS5wb3N0KHRoaXMuJGh0dHBVcmwrJy9jb21wL3VwbG9hZFJlc3VsdCcsIGZvcm1EYXRhKS50aGVuKHJlcyA9PiByZXMuZGF0YSkgLnRoZW4ocmVzID0+ew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcykNCiAgICAgICAgICAgICAgICBpZihyZXMuY29kZSA9PT0gMSl7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5LiK5Lyg5oiQ5YqfJyk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZmlsZUxpc3QgPSBbXTsgLy8g5LiK5Lyg5oiQ5Yqf5bCx5Yid5aeL5YyW5paH5Lu25YiX6KGoDQogICAgICAgICAgICAgICAgfWVsc2V7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoKTsgLy8g5LiK5Lyg5aSx6LSl5bCx6L6T5Ye65aSx6LSl5L+h5oGvDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+ew0KICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZXJyKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9LA0KICAgICAgICAvLyDoh6rlrprkuYnkuIrkvKDlip/og70NCiAgICAgICAgc3VibWl0VXBsb2FkKCl7DQogICAgICAgICAgICB0aGlzLiRyZWZzLnVwbG9hZC5zdWJtaXQoKTsgLy8g6L+Z5Liq5Lya6Kem5Y+RdXBsb2Fk55qEaHR0cC1yZXF1ZXN077yM5omL5Yqo5LiK5Lyg5paH5Lu2DQogICAgICAgIH0sDQoNCg0KDQogICAgfQ0KfQ0K"},{"version":3,"sources":["File.vue"],"names":[],"mappings":";AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA","file":"File.vue","sourceRoot":"src/components","sourcesContent":["<script>\r\nimport axios from 'axios'\r\n\r\n\r\n\r\nexport function uploadResult(){ // 上传文件的方法\r\n    return axios.create({\r\n        withCredentials: true,\r\n    });\r\n}\r\n\r\nexport default {\r\n    name: \"File\",\r\n    data() {\r\n\r\n        return {\r\n          dialogVisible: false,\r\n          tags: [\"游戏\", \"学习\", \"学术\", \"娱乐\", \"工作\"], // 可选择的标签\r\n          selectedTags: [],\r\n            user : JSON.parse(sessionStorage.getItem('CurUser')),\r\n            fileList: [],\r\n        }\r\n    },\r\n    computed:{\r\n\r\n    },\r\n    methods:{\r\n      showDialog() {\r\n        // 检验用户是否未选取文件就上传\r\n        if(this.fileList.length === 0){\r\n          this.$message.warning('请添加文件');\r\n          return\r\n        }\r\n        this.selectedTags = []\r\n        this.dialogVisible = true;\r\n      },\r\n      confirmSelection() {\r\n        console.log(\"已选择的标签:\", this.selectedTags);\r\n        this.dialogVisible = false;\r\n        this.submitUpload()\r\n      },\r\n        fileChange(file, fileList) {\r\n            // 因为是限制为只能上传一个文件，所以前端选取文件时，如果选取第二个文件时，要把第一个文件给覆盖掉。\r\n            this.fileList = [fileList[fileList.length - 1]];\r\n            // 也可以这样写：\r\n            // this.fileList = [file];\r\n        },\r\n        reset(){\r\n            // 当对话框关闭时，清空已上传的文件列表，同时fileList重新设置为空数组\r\n            this.$refs.upload.clearFiles(); // 这个是el-upload自带的清空文件列表方法\r\n            this.fileList = [];\r\n        },\r\n        uploadHttpRequest(){\r\n            const formData = new FormData();\r\n            formData.append('file', this.fileList[0].raw); // 要上传的文件\r\n            formData.append('userId', this.user.id); // 用户id\r\n            const label = this.selectedTags.join(',');\r\n          formData.append('label', label);\r\n          // ${server.url}/comp/uploadResult 这个是后端接收的接口\r\n            // withCredentials: true一定要设置，否则可能会上传不成功，这是个坑\r\n            console.log(\"准备上传\")\r\n            uploadResult().post(this.$httpUrl+'/comp/uploadResult', formData).then(res => res.data) .then(res =>{\r\n                console.log(res)\r\n                if(res.code === 1){\r\n                    this.$message.success('上传成功');\r\n                    this.fileList = []; // 上传成功就初始化文件列表\r\n                }else{\r\n                    this.$message.error(); // 上传失败就输出失败信息\r\n                }\r\n            }).catch(err =>{\r\n                this.$message.error(err);\r\n            });\r\n        },\r\n        // 自定义上传功能\r\n        submitUpload(){\r\n            this.$refs.upload.submit(); // 这个会触发upload的http-request，手动上传文件\r\n        },\r\n\r\n\r\n\r\n    }\r\n}\r\n</script>\r\n\r\n<template>\r\n    <div>\r\n<!--        <el-dialog width=\"400px\" top=\"8vh\" title=\"上传文件\" @close=\"closeUpload\" :visible.sync=\"upload_visible\">-->\r\n            <el-upload :file-list=\"fileList\"\r\n                       :auto-upload=\"false\"\r\n                       :http-request=\"uploadHttpRequest\"\r\n                       class=\"upload-demo\"\r\n                       :on-change=\"fileChange\"\r\n                       ref=\"upload\"\r\n                       drag\r\n                       action=\"#\">\r\n                <i class=\"el-icon-upload\"/>\r\n                <div class=\"el-upload__text\">将文件拖到此处，或<em>点击选取文件</em></div>\r\n                <div slot=\"tip\" class=\"el-upload__tip\">一次只能上传一个文件</div>\r\n            </el-upload>\r\n            <el-button type=\"danger\" @click=\"reset\" style=\"margin-left: 30px; margin-top: 20px\">清空列表</el-button>\r\n            <el-button type=\"success\" @click=\"showDialog\" style=\"margin-left: 30px; margin-top: 20px\">上传</el-button>\r\n<!--        </el-dialog>-->\r\n\r\n      <el-dialog :visible.sync=\"dialogVisible\" title=\"请选择文件标签\">\r\n        <el-checkbox-group v-model=\"selectedTags\">\r\n          <el-checkbox v-for=\"tag in tags\" :label=\"tag\" :key=\"tag\">{{ tag }}</el-checkbox>\r\n        </el-checkbox-group>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"confirmSelection\">确定</el-button>\r\n      </span>\r\n      </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<style scoped>\r\n\r\n</style>\r\n"]}]}